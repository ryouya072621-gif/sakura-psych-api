<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã•ãã‚‰ä¼š å¿ƒç†è¨ºæ–­ãƒ†ã‚¹ãƒˆ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root {
            --sakura-pink: #F8BBD9;
            --sakura-pink-light: #FCE4EC;
            --sakura-pink-dark: #E91E8C;
            --sakura-accent: #D81B60;
            --text-dark: #333;
            --text-light: #666;
            --bg-light: #FFF5F8;
            --white: #fff;
            --shadow: 0 4px 15px rgba(233, 30, 140, 0.15);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: "Hiragino Kaku Gothic ProN", "ãƒ¡ã‚¤ãƒªã‚ª", sans-serif;
            background: linear-gradient(135deg, var(--bg-light) 0%, #fff 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.7;
            color: var(--text-dark);
        }

        h1 {
            text-align: center;
            color: var(--sakura-accent);
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 30px;
        }

        .card {
            max-width: 700px;
            margin: 20px auto;
            background: var(--white);
            padding: 30px;
            border-radius: 20px;
            box-shadow: var(--shadow);
        }

        .card h2 {
            color: var(--sakura-accent);
            font-size: 1.3rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--sakura-pink);
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--text-dark);
        }

        input[type="text"],
        input[type="email"],
        select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--sakura-pink);
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--sakura-accent);
        }

        .btn {
            display: inline-block;
            padding: 14px 30px;
            background: linear-gradient(135deg, var(--sakura-pink-dark) 0%, var(--sakura-accent) 100%);
            border: none;
            color: white;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(233, 30, 140, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--sakura-accent);
            border: 2px solid var(--sakura-accent);
        }

        .btn-secondary:hover {
            background: var(--sakura-pink-light);
        }

        .btn-group {
            text-align: center;
            margin-top: 20px;
        }

        /* è³ªå•ç”»é¢ */
        .progress-bar {
            height: 8px;
            background: var(--sakura-pink-light);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--sakura-pink-dark), var(--sakura-accent));
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            color: var(--sakura-accent);
            font-weight: bold;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.2rem;
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: var(--sakura-pink-light);
            border-radius: 15px;
        }

        .answer-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .answer-btn {
            padding: 15px 20px;
            background: var(--white);
            border: 2px solid var(--sakura-pink);
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            transition: all 0.2s;
            text-align: left;
        }

        .answer-btn:hover {
            background: var(--sakura-pink-light);
            border-color: var(--sakura-accent);
            transform: translateX(5px);
        }

        .answer-scale {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 20px;
            padding: 0 10px;
        }

        /* çµæœç”»é¢ */
        .result-header {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, var(--sakura-pink-light) 0%, #fff 100%);
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .type-badge {
            display: inline-block;
            padding: 8px 25px;
            background: var(--sakura-accent);
            color: white;
            border-radius: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .one-liner {
            font-size: 1.1rem;
            color: var(--text-dark);
            margin-top: 15px;
        }

        .axis-grid {
            display: grid;
            gap: 15px;
            margin: 20px 0;
        }

        .axis-item {
            padding: 15px;
            background: var(--sakura-pink-light);
            border-radius: 12px;
        }

        .axis-name {
            font-weight: bold;
            color: var(--sakura-accent);
            font-size: 1.1rem;
        }

        .axis-level {
            display: inline-block;
            padding: 4px 12px;
            background: var(--sakura-accent);
            color: white;
            border-radius: 15px;
            font-size: 0.9rem;
            margin-left: 10px;
        }

        .axis-desc {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 5px;
        }

        .section {
            margin: 25px 0;
            padding: 20px;
            background: var(--sakura-pink-light);
            border-radius: 15px;
        }

        .section h3 {
            color: var(--sakura-accent);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .section li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .section li::before {
            content: "â—";
            position: absolute;
            left: 0;
            color: var(--sakura-accent);
        }

        .work-style-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .work-style-item {
            padding: 15px;
            background: white;
            border-radius: 10px;
            text-align: center;
        }

        .work-style-label {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 5px;
        }

        .work-style-value {
            font-weight: bold;
            color: var(--sakura-accent);
        }

        .stress-meter {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }

        .stress-bar {
            flex: 1;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .stress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffcccc, #ff6b6b, #28a745);
            transition: width 0.5s ease;
        }

        .stress-label {
            font-weight: bold;
            color: var(--sakura-accent);
            min-width: 60px;
        }

        .email-status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .email-success {
            background: #e6fff0;
            color: #008040;
        }

        .email-error {
            background: #ffe6e6;
            color: #cc0000;
        }

        .hidden {
            display: none !important;
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--sakura-pink);
            border-top-color: var(--sakura-accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 600px) {
            .card {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .btn {
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>

<h1>ğŸŒ¸ ã•ãã‚‰ä¼š å¿ƒç†è¨ºæ–­ãƒ†ã‚¹ãƒˆ</h1>
<p class="subtitle">ã‚ãªãŸã®ç‰¹æ€§ã‚’çŸ¥ã‚Šã€ã‚ˆã‚Šè‰¯ã„è·å ´ç’°å¢ƒã¥ãã‚Šã«æ´»ã‹ã—ã¾ã™</p>

<!-- ===========================
      1. å…¥åŠ›ç”»é¢
=========================== -->
<div class="card" id="startBox">
    <h2>ğŸ“ å—æ¤œè€…æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>

    <label>ãŠåå‰ <span style="color: #cc0000;">*</span></label>
    <input id="userName" type="text" placeholder="ä¾‹ï¼šç”°ä¸­ å¤ªéƒ">

    <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span style="color: #cc0000;">*</span></label>
    <input id="userEmail" type="email" placeholder="ä¾‹ï¼šexample@sakura-kai.jp">

    <label>æ‰€å±ã‚«ãƒ†ã‚´ãƒª</label>
    <select id="userCompany">
        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
    </select>

    <label>è·ç¨®ï¼éƒ¨ç½²</label>
    <input id="userDept" type="text" placeholder="ä¾‹ï¼šæ­¯ç§‘è¡›ç”Ÿå£«ã€å—ä»˜ãªã©">

    <div class="btn-group">
        <button class="btn" onclick="startTest()">è¨ºæ–­ã‚’é–‹å§‹ã™ã‚‹ â†’</button>
    </div>
</div>


<!-- ===========================
      2. è³ªå•ç”»é¢
=========================== -->
<div class="card hidden" id="questionBox">
    <h2>ğŸ’­ è³ªå•ã«ç­”ãˆã¦ãã ã•ã„</h2>
    
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
    </div>
    <div class="progress-text" id="progressText">è³ªå• 1 / 72</div>
    
    <div class="question-text" id="questionText"></div>

    <div class="answer-buttons">
        <button class="answer-btn" onclick="answer(1)">ã¾ã£ãŸãå½“ã¦ã¯ã¾ã‚‰ãªã„</button>
        <button class="answer-btn" onclick="answer(2)">ã‚ã¾ã‚Šå½“ã¦ã¯ã¾ã‚‰ãªã„</button>
        <button class="answer-btn" onclick="answer(3)">ã©ã¡ã‚‰ã¨ã‚‚ã„ãˆãªã„</button>
        <button class="answer-btn" onclick="answer(4)">ã‚„ã‚„å½“ã¦ã¯ã¾ã‚‹</button>
        <button class="answer-btn" onclick="answer(5)">ã¨ã¦ã‚‚å½“ã¦ã¯ã¾ã‚‹</button>
    </div>

    <div class="answer-scale">
        <span>â† å½“ã¦ã¯ã¾ã‚‰ãªã„</span>
        <span>å½“ã¦ã¯ã¾ã‚‹ â†’</span>
    </div>

    <div class="btn-group" style="margin-top: 30px;">
        <button class="btn btn-secondary" onclick="goBack()">â† æˆ»ã‚‹</button>
    </div>
</div>


<!-- ===========================
      3. çµæœç”»é¢
=========================== -->
<div class="card hidden" id="resultBox">
    <h2>ğŸ“Š è¨ºæ–­çµæœ</h2>

    <div id="loadingArea" class="loading">
        <div class="spinner"></div>
        <p>è¨ºæ–­çµæœã‚’è¨ˆç®—ä¸­ã§ã™...</p>
    </div>

    <div id="resultContent" class="hidden">
        <!-- çµæœãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="result-header">
            <p><strong id="resultName"></strong> æ§˜ã®è¨ºæ–­çµæœ</p>
            <div class="type-badge" id="resultType"></div>
            <p class="one-liner" id="resultOneLiner"></p>
        </div>

        <!-- 4è»¸ã®å‚¾å‘ -->
        <div class="section">
            <h3>ğŸ¯ 4ã¤ã®ç‰¹æ€§</h3>
            <div class="axis-grid" id="axisGrid"></div>
        </div>

        <!-- å¼·ã¿ -->
        <div class="section">
            <h3>ğŸ’ª å¼·ã¿</h3>
            <ul id="strengthsList"></ul>
        </div>

        <!-- å¼±ã¿ãƒ»æ³¨æ„ç‚¹ -->
        <div class="section">
            <h3>âš ï¸ æ³¨æ„ç‚¹</h3>
            <ul id="weaknessesList"></ul>
        </div>

        <!-- ã‚¹ãƒˆãƒ¬ã‚¹ -->
        <div class="section">
            <h3>ğŸ˜° ã‚¹ãƒˆãƒ¬ã‚¹ã‚’æ„Ÿã˜ã‚„ã™ã„å ´é¢</h3>
            <ul id="stressSituationsList"></ul>
        </div>

        <div class="section">
            <h3>ğŸŒ¿ ã‚¹ãƒˆãƒ¬ã‚¹å¯¾å‡¦æ³•</h3>
            <ul id="stressCopingList"></ul>
        </div>

        <!-- ä»•äº‹ã‚¹ã‚¿ã‚¤ãƒ« -->
        <div class="section">
            <h3>ğŸ’¼ ä»•äº‹ã®ã‚¹ã‚¿ã‚¤ãƒ«</h3>
            <div class="work-style-grid" id="workStyleGrid"></div>
        </div>

        <!-- ã‚¹ãƒˆãƒ¬ã‚¹è€æ€§ -->
        <div class="section">
            <h3>ğŸ›¡ï¸ ã‚¹ãƒˆãƒ¬ã‚¹è€æ€§</h3>
            <div class="stress-meter">
                <span class="stress-label" id="stressLabel">5 / 10</span>
                <div class="stress-bar">
                    <div class="stress-fill" id="stressFill" style="width: 50%"></div>
                </div>
            </div>
        </div>

        <!-- ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
        <div id="emailStatus" class="email-status hidden"></div>

        <!-- æ“ä½œãƒœã‚¿ãƒ³ -->
        <div class="btn-group">
            <button class="btn" onclick="sendEmail()">ğŸ“© çµæœã‚’ãƒ¡ãƒ¼ãƒ«ã§å—ã‘å–ã‚‹</button>
            <button class="btn btn-secondary" onclick="resetTest()">ğŸ”„ ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹</button>
        </div>
    </div>
</div>


<script>
const API_ENDPOINT = "/api/sakura_psych";

const questions = [
    "ç·Šå¼µã™ã‚‹å ´é¢ã§ã‚‚è½ã¡ç€ã„ã¦è¡Œå‹•ã§ãã‚‹ã»ã†ã ã€‚",
    "ç«¶äº‰ãŒã‚ã‚‹ç’°å¢ƒã®ã»ã†ãŒåŠ›ã‚’ç™ºæ®ã—ã‚„ã™ã„ã€‚",
    "ä»•äº‹ã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã®åˆ‡ã‚Šæ›¿ãˆãŒå¾—æ„ã ã€‚",
    "å‘¨ã‚Šã‹ã‚‰ã®è©•ä¾¡ãŒã‚ã‚‹ã¨é ‘å¼µã‚Œã‚‹ã‚¿ã‚¤ãƒ—ã ã€‚",
    "æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã™ã‚‹éš›ã€ãƒªã‚¹ã‚¯ã‚’å–ã‚Œã‚‹ã»ã†ã ã€‚",
    "ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ãŒã‹ã‹ã‚‹ã»ã©ç‡ƒãˆã‚‹ã‚¿ã‚¤ãƒ—ã ã€‚",
    "çªç„¶ã®äºˆå®šå¤‰æ›´ã«ã‚‚æŸ”è»Ÿã«å¯¾å¿œã§ãã‚‹ã€‚",
    "è‡ªåˆ†ã®ãƒŸã‚¹ã‚’å¼•ããšã‚‰ãšã«æ°—æŒã¡ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã€‚",
    "å¿™ã—ã„çŠ¶æ³ã§ã‚‚å†·é™ã«å„ªå…ˆé †ä½ã‚’ã¤ã‘ã‚‰ã‚Œã‚‹ã€‚",
    "å¦å®šçš„ãªæ„è¦‹ã‚’å—ã‘ã¦ã‚‚ã€ã™ãã«ç«‹ã¦ç›´ã›ã‚‹ã»ã†ã ã€‚",
    "æ„Ÿæƒ…çš„ã«ãªã‚‰ãšã«ã€çŠ¶æ³ã‚’å®¢è¦³çš„ã«è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚",
    "è½ã¡è¾¼ã‚“ã§ã‚‚ã€æ¯”è¼ƒçš„æ—©ãæ°—æŒã¡ã‚’ç«‹ã¦ç›´ã›ã‚‹ã€‚",
    "å¤§ããªå¤±æ•—ã‚’ã—ã¦ã‚‚ã€æ¬¡ã¸ã®å­¦ã³ã¨ã—ã¦å‰å‘ãã«æ‰ãˆã‚‰ã‚Œã‚‹ã€‚",
    "æ—¥ã€…ã®ã‚¹ãƒˆãƒ¬ã‚¹ã‚’ã†ã¾ãç™ºæ•£ã§ãã¦ã„ã‚‹ã¨æ„Ÿã˜ã‚‹ã€‚",
    "ãƒˆãƒ©ãƒ–ãƒ«ãŒèµ·ãã¦ã‚‚ã€ç„¦ã‚‰ãšå¯¾å‡¦ã§ãã‚‹ã»ã†ã ã€‚",
    "ä»–äººã®æ„Ÿæƒ…ã«å¼•ããšã‚‰ã‚Œã™ããªã„ã»ã†ã ã€‚",
    "äºˆæƒ³å¤–ã®å•é¡ŒãŒèµ·ãã¦ã‚‚ã€æ°—æŒã¡ã‚’ä¹±ã•ãšå¯¾å¿œã§ãã‚‹ã€‚",
    "ä»•äº‹ãŒç«‹ã¦è¾¼ã‚“ã§ã‚‚ã€æ„Ÿæƒ…çš„ã«çˆ†ç™ºã™ã‚‹ã“ã¨ã¯å°‘ãªã„ã€‚",
    "åˆå¯¾é¢ã®äººã¨ã‚‚ã™ãã«æ‰“ã¡è§£ã‘ã‚‰ã‚Œã‚‹ã€‚",
    "è‡ªåˆ†ã®æ„è¦‹ã‚’ã¯ã£ãã‚Šä¼ãˆã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚",
    "äººå‰ã§è©±ã™ã“ã¨ã«å¯¾ã—ã¦ã€ã‚ã¾ã‚ŠæŠµæŠ—ãŒãªã„ã€‚",
    "ç›¸æ‰‹ãŒé–“é•ã£ã¦ã„ã‚‹ã¨æ€ãˆã°ã€ãã¡ã‚“ã¨æŒ‡æ‘˜ã§ãã‚‹ã€‚",
    "ä¼šè­°ãªã©ã§ç™ºè¨€ã™ã‚‹ã“ã¨ã«è‹¦æ‰‹æ„è­˜ã¯ã‚ã¾ã‚Šãªã„ã€‚",
    "è‡ªåˆ†ã®ä¸»å¼µã‚’é€šã™ã¹ãå ´é¢ã§ã¯ã€ãã¡ã‚“ã¨ä¸»å¼µã§ãã‚‹ã€‚",
    "ç›¸æ‰‹ã®é¡”è‰²ã‚’æ°—ã«ã—ã™ããšã«è©±ã›ã‚‹ã€‚",
    "ãŠé¡˜ã„ã”ã¨ã‚„äº¤æ¸‰ã”ã¨ã‚’ã™ã‚‹ã“ã¨ã«æŠµæŠ—ãŒå°‘ãªã„ã€‚",
    "æ„è¦‹ãŒå¯¾ç«‹ã—ã¦ã‚‚ã€è©±ã—åˆã„ã§è§£æ±ºã—ã‚ˆã†ã¨ã™ã‚‹ã€‚",
    "ãƒªãƒ¼ãƒ€ãƒ¼å½¹ã‚’ä»»ã•ã‚Œã‚‹ã“ã¨ã«æŠµæŠ—ã¯å°‘ãªã„ã€‚",
    "è‡ªåˆ†ã®è€ƒãˆã‚’åˆ†ã‹ã‚Šã‚„ã™ãæ•´ç†ã—ã¦ä¼ãˆã‚‰ã‚Œã‚‹ã€‚",
    "ç›¸æ‰‹ã«ã¨ã£ã¦è€³ã®ç—›ã„ã“ã¨ã‚‚ã€å¿…è¦ã§ã‚ã‚Œã°ä¼ãˆã‚‰ã‚Œã‚‹ã€‚",
    "ç›¸æ‰‹ã«NOã‚’è¨€ã†ã¹ãå ´é¢ã§ã¯ã€ãã¡ã‚“ã¨æ–­ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚",
    "è‡ªåˆ†ã‹ã‚‰æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚„ææ¡ˆã‚’ã™ã‚‹ã“ã¨ãŒå¤šã„ã€‚",
    "ç›®æ¨™ã«å‘ã‹ã£ã¦è¨ˆç”»çš„ã«è¡Œå‹•ã™ã‚‹ã»ã†ã ã€‚",
    "è‡ªåˆ†ã®æˆé•·ã®ãŸã‚ã«ã€æ„å›³çš„ã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚",
    "èˆˆå‘³ã®ã‚ã‚‹åˆ†é‡ã«ã¤ã„ã¦ã€ä¸»ä½“çš„ã«æƒ…å ±åé›†ã™ã‚‹ã»ã†ã ã€‚",
    "ä»»ã•ã‚ŒãŸä»•äº‹ä»¥ä¸Šã®ã“ã¨ã«å–ã‚Šçµ„ã‚€ã“ã¨ãŒã‚ã‚‹ã€‚",
    "å‘¨ã‚Šã®äººã‚’å·»ãè¾¼ã¿ãªãŒã‚‰ç‰©äº‹ã‚’é€²ã‚ã‚‹ã®ãŒå¾—æ„ã ã€‚",
    "æ±‚ã‚ã‚‰ã‚Œã¦ã„ãªãã¦ã‚‚ã€è‡ªåˆ†ã‹ã‚‰ä»•äº‹ã‚’æ¢ã—ã¦å‹•ãã“ã¨ãŒã‚ã‚‹ã€‚",
    "ã‚„ã‚‹ã¹ãã“ã¨ã‚’å…ˆå»¶ã°ã—ã«ã›ãšã€ã™ãã«å–ã‚Šã‹ã‹ã‚‹ã»ã†ã ã€‚",
    "è‡ªåˆ†ã®ã‚­ãƒ£ãƒªã‚¢ã«ã¤ã„ã¦ä¸»ä½“çš„ã«è€ƒãˆã¦è¡Œå‹•ã—ã¦ã„ã‚‹ã€‚",
    "æ–°ã—ã„å½¹å‰²ã‚„ãƒã‚¸ã‚·ãƒ§ãƒ³ã«ã‚‚å‰å‘ãã«æ‰‹ã‚’æŒ™ã’ã‚‰ã‚Œã‚‹ã€‚",
    "è‡ªåˆ†ã‹ã‚‰ç’°å¢ƒã‚’å¤‰ãˆã‚‹è¡Œå‹•ã‚’ã¨ã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚",
    "ã‚¹ãƒˆãƒ¬ã‚¹ãŒç¶šã„ã¦ã‚‚ã€ç²˜ã‚Šå¼·ãå–ã‚Šçµ„ã‚ã‚‹ã»ã†ã ã€‚",
    "å¿™ã—ãã¦ã‚‚ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å¤§ããè½ã¨ã•ãšã«åƒã‘ã‚‹ã€‚",
    "å¿ƒèº«ã®ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ç®¡ç†ã‚’æ„è­˜ã—ã¦ã„ã‚‹ã€‚",
    "ä»•äº‹ãŒé‡ãªã£ã¦ã‚‚ã€ãƒ‘ãƒ³ã‚¯ã›ãšã«å¯¾å‡¦ã§ãã‚‹ã»ã†ã ã€‚",
    "é•·æœŸçš„ã«ãƒãƒ¼ãƒ‰ãƒ¯ãƒ¼ã‚¯ãŒç¶šã„ã¦ã‚‚ã€ãªã‚“ã¨ã‹ä¹—ã‚Šåˆ‡ã£ã¦ããŸã€‚",
    "ã‚¹ãƒˆãƒ¬ã‚¹ã‚’æ„Ÿã˜ã¦ã‚‚ã€å†·é™ã«çŠ¶æ³ã‚’æ•´ç†ã—ã¦å¯¾å‡¦ã§ãã‚‹ã€‚",
    "ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ã®ã‹ã‹ã‚‹å ´é¢ã§ã‚‚ã€è‡ªåˆ†ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã§ãã‚‹ã€‚",
    "ä½“èª¿ç®¡ç†ã‚„ç¡çœ æ™‚é–“ã®ç¢ºä¿ãªã©ã€è‡ªå·±ç®¡ç†ãŒã§ãã¦ã„ã‚‹ã€‚",
    "ç²¾ç¥çš„ã«ã‚¿ãƒ•ã ã¨è¨€ã‚ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚",
    "é›£ã—ã„çŠ¶æ³ã§ã‚‚ã€Œãªã‚“ã¨ã‹ãªã‚‹ã€ã¨å‰å‘ãã«è€ƒãˆã‚‰ã‚Œã‚‹ã€‚",
    "æŒ‡ç¤ºãŒæ›–æ˜§ã§ã‚‚ã€è‡ªåˆ†ãªã‚Šã«è€ƒãˆã¦å‹•ã‘ã‚‹ã»ã†ã ã€‚",
    "ã‚¤ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ãªäº‹æ…‹ã«ã‚‚æŸ”è»Ÿã«å¯¾å¿œã§ãã‚‹ã€‚",
    "æ–°ã—ã„ä»•äº‹ã‚’è¦šãˆã‚‹ã®ã¯æ¯”è¼ƒçš„æ—©ã„ã»ã†ã ã€‚",
    "çŠ¶æ³ã«å¿œã˜ã¦ã€å½¹å‰²ã‚„ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å¤‰ãˆã‚‰ã‚Œã‚‹ã€‚",
    "å‘¨å›²ã®å¤‰åŒ–ã«åˆã‚ã›ã¦ã€è‡ªåˆ†ã®ã‚„ã‚Šæ–¹ã‚’èª¿æ•´ã§ãã‚‹ã€‚",
    "è¤‡æ•°ã®ä»•äº‹ã‚’åŒæ™‚ã«å›ã™ã“ã¨ã«æ…£ã‚Œã¦ã„ã‚‹ã€‚",
    "æ€¥ãªä¾é ¼ã«ã‚‚ã€ã§ãã‚‹ç¯„å›²ã§å¯¾å¿œã—ã‚ˆã†ã¨ã™ã‚‹ã€‚",
    "å¤‰åŒ–ã®å¤šã„ç’°å¢ƒã§ã‚‚ã€ã‚ã¾ã‚Šã‚¹ãƒˆãƒ¬ã‚¹ã‚’æ„Ÿã˜ã«ãã„ã€‚",
    "äºˆæœŸã›ã¬å•é¡ŒãŒèµ·ãã¦ã‚‚ã€ãã®å ´ã§å·¥å¤«ã—ã¦ä¹—ã‚Šåˆ‡ã‚Œã‚‹ã€‚",
    "æ–°ã—ã„ãƒ„ãƒ¼ãƒ«ã‚„ã‚·ã‚¹ãƒ†ãƒ ã«ã‚‚ã€æ¯”è¼ƒçš„ã™ãæ…£ã‚Œã‚‰ã‚Œã‚‹ã€‚",
    "åŒæ™‚ä¸¦è¡Œã§è¤‡æ•°ã®æ¡ˆä»¶ã‚’æ‰±ã†ã“ã¨ã«æŠµæŠ—ãŒå°‘ãªã„ã€‚",
    "ã‚³ãƒ„ã‚³ãƒ„ã¨ç¶™ç¶šã—ã¦å–ã‚Šçµ„ã‚€ã“ã¨ãŒå¾—æ„ã ã€‚",
    "ç´°ã‹ãªä½œæ¥­ã‚„ãƒã‚§ãƒƒã‚¯ã‚’ä¸å¯§ã«è¡Œã†ã»ã†ã ã€‚",
    "ç´„æŸã‚„æœŸé™ã¯ãã¡ã‚“ã¨å®ˆã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€‚",
    "ä¸€åº¦æ±ºã‚ãŸãƒ«ãƒ¼ãƒ«ã‚„æ‰‹é †ã¯ã€åŸºæœ¬çš„ã«å®ˆã‚‹ã»ã†ã ã€‚",
    "ä»•äº‹ã‚’é€”ä¸­ã§æŠ•ã’å‡ºã•ãšã€æœ€å¾Œã¾ã§ã‚„ã‚Šãã‚‹ã»ã†ã ã€‚",
    "æ—¥ã€…ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³æ¥­å‹™ã«ã‚‚ã€å®‰å®šã—ã¦å–ã‚Šçµ„ã‚ã‚‹ã€‚",
    "å°ã•ãªæ”¹å–„ã‚’ç©ã¿é‡ã­ã¦ã„ãã“ã¨ãŒå¥½ãã ã€‚",
    "ãƒŸã‚¹ã‚’æ¸›ã‚‰ã™ãŸã‚ã®å·¥å¤«ã‚’è‡ªåˆ†ãªã‚Šã«è¡Œã£ã¦ã„ã‚‹ã€‚",
    "ç›¸æ‰‹ã®ç«‹å ´ã‚„çŠ¶æ³ã‚’æƒ³åƒã—ãªãŒã‚‰è¡Œå‹•ã™ã‚‹ã»ã†ã ã€‚",
];

let currentIndex = 0;
let answers = [];
let userData = {};
let currentResultId = null;

// ä¼šç¤¾ã‚«ãƒ†ã‚´ãƒªã‚’èª­ã¿è¾¼ã¿
async function loadCompanyCategories() {
    try {
        const response = await fetch("/api/company_categories");
        const data = await response.json();
        if (data.ok) {
            const select = document.getElementById("userCompany");
            data.categories.forEach(cat => {
                const option = document.createElement("option");
                option.value = cat;
                option.textContent = cat;
                select.appendChild(option);
            });
        }
    } catch (e) {
        console.error("Failed to load company categories:", e);
    }
}

// åˆæœŸåŒ–
document.addEventListener("DOMContentLoaded", () => {
    loadCompanyCategories();
});

function startTest() {
    const name = document.getElementById("userName").value.trim();
    const email = document.getElementById("userEmail").value.trim();
    const company = document.getElementById("userCompany").value;
    const dept = document.getElementById("userDept").value.trim();

    if (!name || !email) {
        alert("ãŠåå‰ã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å¿…é ˆã§ã™ã€‚");
        return;
    }

    if (!email.includes("@")) {
        alert("æ­£ã—ã„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
    }

    userData = { name, email, company, department: dept };
    currentIndex = 0;
    answers = [];

    document.getElementById("startBox").classList.add("hidden");
    document.getElementById("questionBox").classList.remove("hidden");
    document.getElementById("resultBox").classList.add("hidden");

    showQuestion();
}

function showQuestion() {
    const progress = ((currentIndex) / questions.length) * 100;
    document.getElementById("progressFill").style.width = progress + "%";
    document.getElementById("progressText").innerText = 
        `è³ªå• ${currentIndex + 1} / ${questions.length}`;
    document.getElementById("questionText").innerText = questions[currentIndex];
}

function answer(value) {
    answers.push(Number(value));
    currentIndex++;

    if (currentIndex >= questions.length) {
        finishTest();
    } else {
        showQuestion();
    }
}

function goBack() {
    if (currentIndex > 0) {
        currentIndex--;
        answers.pop();
        showQuestion();
    } else {
        if (confirm("å…¥åŠ›ç”»é¢ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿå›ç­”ã¯ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚")) {
            document.getElementById("questionBox").classList.add("hidden");
            document.getElementById("startBox").classList.remove("hidden");
        }
    }
}

function finishTest() {
    document.getElementById("questionBox").classList.add("hidden");
    document.getElementById("resultBox").classList.remove("hidden");
    document.getElementById("loadingArea").classList.remove("hidden");
    document.getElementById("resultContent").classList.add("hidden");

    sendResultsToServer();
}

async function sendResultsToServer() {
    try {
        const response = await fetch(API_ENDPOINT, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                answers: answers,
                meta: userData
            }),
        });

        const data = await response.json();
        console.log("API response:", data);

        if (!data.ok) {
            showError("è¨ºæ–­å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼š" + (data.error || "ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"));
            return;
        }

        currentResultId = data.result_id;
        displayResult(data);

    } catch (err) {
        console.error(err);
        showError("ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
    }
}

function showError(message) {
    document.getElementById("loadingArea").classList.add("hidden");
    document.getElementById("resultContent").classList.remove("hidden");
    document.getElementById("resultContent").innerHTML = `
        <div style="text-align: center; color: #cc0000; padding: 40px;">
            <p>âš ï¸ ${message}</p>
            <button class="btn btn-secondary" onclick="resetTest()">ğŸ”„ ã‚‚ã†ä¸€åº¦è©¦ã™</button>
        </div>
    `;
}

function displayResult(data) {
    const report = data.report;
    const result = data.result;

    document.getElementById("loadingArea").classList.add("hidden");
    document.getElementById("resultContent").classList.remove("hidden");

    // åŸºæœ¬æƒ…å ±
    document.getElementById("resultName").textContent = userData.name;
    document.getElementById("resultType").textContent = 
        `${getTypeNameJP(result.type)}ï¼ˆTYPE ${result.type}ï¼‰`;
    document.getElementById("resultOneLiner").textContent = report.one_liner;

    // 4è»¸
    const axisGrid = document.getElementById("axisGrid");
    axisGrid.innerHTML = "";
    report.axis_info.forEach(axis => {
        axisGrid.innerHTML += `
            <div class="axis-item">
                <span class="axis-name">${axis.name}</span>
                <span class="axis-level">${axis.level}</span>
                <p class="axis-desc">${axis.description}</p>
            </div>
        `;
    });

    // å¼·ã¿
    const strengthsList = document.getElementById("strengthsList");
    strengthsList.innerHTML = "";
    report.strengths.forEach(s => {
        strengthsList.innerHTML += `<li>${s}</li>`;
    });

    // å¼±ã¿
    const weaknessesList = document.getElementById("weaknessesList");
    weaknessesList.innerHTML = "";
    report.weaknesses.forEach(w => {
        weaknessesList.innerHTML += `<li>${w}</li>`;
    });

    // ã‚¹ãƒˆãƒ¬ã‚¹å ´é¢
    const stressSituationsList = document.getElementById("stressSituationsList");
    stressSituationsList.innerHTML = "";
    report.stress_situations.forEach(s => {
        stressSituationsList.innerHTML += `<li>${s}</li>`;
    });

    // ã‚¹ãƒˆãƒ¬ã‚¹å¯¾å‡¦æ³•
    const stressCopingList = document.getElementById("stressCopingList");
    stressCopingList.innerHTML = "";
    report.stress_coping.forEach(c => {
        stressCopingList.innerHTML += `<li>${c}</li>`;
    });

    // ä»•äº‹ã‚¹ã‚¿ã‚¤ãƒ«
    const workStyleGrid = document.getElementById("workStyleGrid");
    const ws = report.work_style;
    workStyleGrid.innerHTML = `
        <div class="work-style-item">
            <div class="work-style-label">å”åƒã‚¹ã‚¿ã‚¤ãƒ«</div>
            <div class="work-style-value">${ws.collaboration}</div>
        </div>
        <div class="work-style-item">
            <div class="work-style-label">ãƒšãƒ¼ã‚¹</div>
            <div class="work-style-value">${ws.pace}</div>
        </div>
        <div class="work-style-item">
            <div class="work-style-label">ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</div>
            <div class="work-style-value">${ws.approach}</div>
        </div>
        <div class="work-style-item">
            <div class="work-style-label">æ€è€ƒã‚¹ã‚¿ã‚¤ãƒ«</div>
            <div class="work-style-value">${ws.thinking}</div>
        </div>
    `;

    // ã‚¹ãƒˆãƒ¬ã‚¹è€æ€§
    const stressTolerance = report.stress_tolerance;
    document.getElementById("stressLabel").textContent = `${stressTolerance} / 10`;
    document.getElementById("stressFill").style.width = (stressTolerance * 10) + "%";
}

function getTypeNameJP(type) {
    const map = {
        "S": "å’Œå‹",
        "P": "é™½å‹",
        "C": "ç†å‹",
        "D": "å°å‹"
    };
    return map[type] || type;
}

async function sendEmail() {
    if (!currentResultId) {
        alert("çµæœIDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
        return;
    }

    const statusEl = document.getElementById("emailStatus");
    statusEl.classList.remove("hidden", "email-success", "email-error");
    statusEl.textContent = "ğŸ“© ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ä¸­...";

    try {
        const response = await fetch("/api/send-email", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                result_id: currentResultId,
                email: userData.email
            }),
        });

        const data = await response.json();
        if (data.success) {
            statusEl.classList.add("email-success");
            statusEl.textContent = "âœ… ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼";
        } else {
            statusEl.classList.add("email-error");
            statusEl.textContent = "âŒ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ: " + (data.error || "");
        }
    } catch (err) {
        statusEl.classList.add("email-error");
        statusEl.textContent = "âŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
    }
}

function resetTest() {
    currentIndex = 0;
    answers = [];
    userData = {};
    currentResultId = null;

    document.getElementById("resultBox").classList.add("hidden");
    document.getElementById("startBox").classList.remove("hidden");
    
    // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
    document.getElementById("userName").value = "";
    document.getElementById("userEmail").value = "";
    document.getElementById("userCompany").value = "";
    document.getElementById("userDept").value = "";
}
</script>

</body>
</html>
