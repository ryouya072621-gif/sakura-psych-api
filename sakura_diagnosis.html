<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã•ãã‚‰ä¼š å¿ƒç†è¨ºæ–­ãƒ†ã‚¹ãƒˆ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --sakura-pink: #FFB7C5;
            --sakura-pink-light: #FFF0F5;
            --sakura-pink-dark: #DB7093;
            --sakura-accent: #C71585;
            --mint-green: #98FB98;
            --lavender: #E6E6FA;
            --peach: #FFDAB9;
            --text-dark: #333;
            --text-light: #666;
            --bg-light: #FFF8FA;
            --white: #fff;
            --shadow: 0 4px 20px rgba(199, 21, 133, 0.12);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: "Hiragino Kaku Gothic ProN", "ãƒ¡ã‚¤ãƒªã‚ª", sans-serif;
            background: linear-gradient(135deg, var(--bg-light) 0%, var(--lavender) 50%, var(--peach) 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.7;
            color: var(--text-dark);
        }

        h1 {
            text-align: center;
            color: var(--sakura-accent);
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 30px;
        }

        .card {
            max-width: 700px;
            margin: 20px auto;
            background: var(--white);
            padding: 30px;
            border-radius: 25px;
            box-shadow: var(--shadow);
        }

        .card h2 {
            color: var(--sakura-accent);
            font-size: 1.3rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--sakura-pink);
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--text-dark);
        }

        input[type="text"],
        input[type="email"],
        select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--sakura-pink);
            border-radius: 12px;
            font-size: 16px;
            margin-bottom: 15px;
            transition: border-color 0.3s, box-shadow 0.3s;
            background: var(--white);
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--sakura-accent);
            box-shadow: 0 0 10px rgba(199, 21, 133, 0.2);
        }

        .tag-group {
            margin-bottom: 20px;
        }

        .tag-group-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--sakura-accent);
        }

        .tag-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag-option {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            background: var(--sakura-pink-light);
            border: 2px solid transparent;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .tag-option:hover {
            background: var(--sakura-pink);
        }

        .tag-option.selected {
            background: var(--sakura-accent);
            color: white;
            border-color: var(--sakura-accent);
        }

        .tag-option input {
            display: none;
        }

        .notice-box {
            background: linear-gradient(135deg, var(--lavender) 0%, var(--sakura-pink-light) 100%);
            border-left: 4px solid var(--sakura-accent);
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 12px 12px 0;
            font-size: 14px;
        }

        .notice-box strong {
            color: var(--sakura-accent);
        }

        .btn {
            display: inline-block;
            padding: 14px 30px;
            background: linear-gradient(135deg, var(--sakura-pink-dark) 0%, var(--sakura-accent) 100%);
            border: none;
            color: white;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(199, 21, 133, 0.35);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--sakura-accent);
            border: 2px solid var(--sakura-accent);
        }

        .btn-secondary:hover {
            background: var(--sakura-pink-light);
        }

        .btn-group {
            text-align: center;
            margin-top: 20px;
        }

        /* è³ªå•ç”»é¢ */
        .progress-bar {
            height: 10px;
            background: var(--sakura-pink-light);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--sakura-pink), var(--sakura-accent));
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            color: var(--sakura-accent);
            font-weight: bold;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.2rem;
            text-align: center;
            margin: 30px 0;
            padding: 25px;
            background: linear-gradient(135deg, var(--sakura-pink-light) 0%, var(--lavender) 100%);
            border-radius: 20px;
        }

        .answer-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .answer-btn {
            padding: 15px 20px;
            background: var(--white);
            border: 2px solid var(--sakura-pink);
            border-radius: 15px;
            cursor: pointer;
            font-size: 15px;
            transition: all 0.2s;
            text-align: left;
        }

        .answer-btn:hover {
            background: var(--sakura-pink-light);
            border-color: var(--sakura-accent);
            transform: translateX(5px);
        }

        /* çµæœç”»é¢ */
        .result-header {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, var(--sakura-pink-light) 0%, var(--lavender) 100%);
            border-radius: 20px;
            margin-bottom: 25px;
        }

        .type-badge {
            display: inline-block;
            padding: 10px 30px;
            background: linear-gradient(135deg, var(--sakura-pink-dark) 0%, var(--sakura-accent) 100%);
            color: white;
            border-radius: 25px;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .type-image {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 15px auto;
            background: var(--sakura-pink-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            box-shadow: 0 4px 15px rgba(199, 21, 133, 0.2);
        }

        .one-liner {
            font-size: 1.1rem;
            color: var(--text-dark);
            margin-top: 15px;
        }

        .detailed-description {
            background: linear-gradient(135deg, var(--peach) 0%, var(--sakura-pink-light) 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 15px;
            line-height: 1.8;
            text-align: justify;
        }

        .relative-note {
            background: var(--lavender);
            border: 1px solid var(--sakura-pink);
            padding: 12px 15px;
            border-radius: 10px;
            font-size: 13px;
            color: var(--text-light);
            margin: 15px 0;
        }

        .chart-container {
            max-width: 400px;
            margin: 20px auto;
        }

        .axis-grid {
            display: grid;
            gap: 15px;
            margin: 20px 0;
        }

        .axis-item {
            padding: 18px;
            background: linear-gradient(135deg, var(--sakura-pink-light) 0%, var(--white) 100%);
            border-radius: 15px;
            border-left: 4px solid var(--sakura-accent);
        }

        .axis-name {
            font-weight: bold;
            color: var(--sakura-accent);
            font-size: 1.1rem;
        }

        .axis-level {
            display: inline-block;
            padding: 4px 14px;
            background: var(--sakura-accent);
            color: white;
            border-radius: 15px;
            font-size: 0.9rem;
            margin-left: 10px;
        }

        .axis-desc {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 5px;
        }

        .section {
            margin: 25px 0;
            padding: 22px;
            background: linear-gradient(135deg, var(--sakura-pink-light) 0%, var(--white) 100%);
            border-radius: 18px;
        }

        .section h3 {
            color: var(--sakura-accent);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .section li {
            padding: 10px 0;
            padding-left: 28px;
            position: relative;
        }

        .section li::before {
            content: "âœ¦";
            position: absolute;
            left: 0;
            color: var(--sakura-accent);
        }

        .info-section {
            margin: 25px 0;
            padding: 22px;
            background: linear-gradient(135deg, #FFF8E1 0%, #FFE0B2 100%);
            border-radius: 18px;
            border: 2px solid #FFB74D;
        }

        .info-section h3 {
            color: #E65100;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .job-fit-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .job-fit-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .job-fit-rank {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .job-fit-rank.rank-1 { background: linear-gradient(135deg, #FFD700, #FFA500); }
        .job-fit-rank.rank-2 { background: linear-gradient(135deg, #C0C0C0, #A0A0A0); }
        .job-fit-rank.rank-3 { background: linear-gradient(135deg, #CD7F32, #A0522D); }

        .job-fit-content {
            flex: 1;
        }

        .job-fit-name {
            font-weight: bold;
            color: var(--text-dark);
            font-size: 1rem;
        }

        .job-fit-desc {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 4px;
        }

        .job-fit-score {
            text-align: right;
            flex-shrink: 0;
        }

        .job-fit-score-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #E65100;
        }

        .job-fit-score-label {
            font-size: 0.75rem;
            color: var(--text-light);
        }

        .work-style-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
        }

        .work-style-item {
            padding: 18px;
            background: white;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .work-style-label {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 5px;
        }

        .work-style-value {
            font-weight: bold;
            color: var(--sakura-accent);
        }

        .stress-meter {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }

        .stress-bar {
            flex: 1;
            height: 24px;
            background: linear-gradient(90deg, #ffcccc 0%, #ffd700 50%, #90EE90 100%);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .stress-indicator {
            position: absolute;
            top: -3px;
            width: 16px;
            height: 30px;
            background: var(--sakura-accent);
            border-radius: 8px;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            transform: translateX(-50%);
        }

        .stress-label {
            font-weight: bold;
            color: var(--sakura-accent);
            min-width: 70px;
            font-size: 1.1rem;
        }

        .stress-note {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 5px;
        }

        .email-status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }

        .email-success {
            background: linear-gradient(135deg, #e6fff0 0%, #d4edda 100%);
            color: #155724;
        }

        .email-error {
            background: linear-gradient(135deg, #ffe6e6 0%, #f8d7da 100%);
            color: #721c24;
        }

        .hidden {
            display: none !important;
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid var(--sakura-pink);
            border-top-color: var(--sakura-accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 600px) {
            .card {
                padding: 20px;
                margin: 10px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .btn {
                width: 100%;
                margin: 5px 0;
            }

            .type-image {
                width: 100px;
                height: 100px;
                font-size: 50px;
            }
        }

        /* å°åˆ·/PDFç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        @media print {
            body {
                background: white;
            }
            .btn, .btn-group {
                display: none;
            }
        }
    </style>
</head>
<body>

<h1>ğŸŒ¸ ã•ãã‚‰ä¼š å¿ƒç†è¨ºæ–­ãƒ†ã‚¹ãƒˆ</h1>
<p class="subtitle">ã‚ãªãŸã®ç‰¹æ€§ã‚’çŸ¥ã‚Šã€ã‚ˆã‚Šè‰¯ã„è·å ´ç’°å¢ƒã¥ãã‚Šã«æ´»ã‹ã—ã¾ã™</p>

<!-- ===========================
      1. å…¥åŠ›ç”»é¢
=========================== -->
<div class="card" id="startBox">
    <h2>ğŸ“ å—æ¤œè€…æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>

    <label>ãŠåå‰ <span style="color: #cc0000;">*</span></label>
    <input id="userName" type="text" placeholder="ä¾‹ï¼šç”°ä¸­ å¤ªéƒ">

    <label>æ‰€å±ã‚«ãƒ†ã‚´ãƒª</label>
    <select id="userCompany">
        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
    </select>


    <div class="notice-box">
        <strong>ğŸ’¡ ã”æ¡ˆå†…</strong><br>
        ã“ã®è¨ºæ–­ã¯ã€ã•ãã‚‰ä¼šã§ã®é…ç½®ãƒ»è‚²æˆãƒ»1on1é¢è«‡ã«æ´»ç”¨ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚<br>
        <strong>æ­£ç›´ã«å›ç­”ã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šæ­£ç¢ºãªçµæœãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚</strong><br>
        åˆå¦ã‚„è©•ä¾¡ã‚’ç›´æ¥æ±ºã‚ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã®ã§ã€ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ã¦ãŠç­”ãˆãã ã•ã„ã€‚
    </div>

    <div class="btn-group">
        <button class="btn" onclick="startTest()">è¨ºæ–­ã‚’é–‹å§‹ã™ã‚‹ â†’</button>
    </div>
</div>


<!-- ===========================
      2. è³ªå•ç”»é¢
=========================== -->
<div class="card hidden" id="questionBox">
    <h2>ğŸ’­ è³ªå•ã«ç­”ãˆã¦ãã ã•ã„</h2>

    <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
    </div>
    <div class="progress-text" id="progressText">è³ªå• 1 / 72</div>

    <div class="question-text" id="questionText"></div>

    <div class="answer-buttons">
        <button class="answer-btn" onclick="answer(1)">1 - ä¸Šã®é¸æŠè‚¢ã«è¿‘ã„</button>
        <button class="answer-btn" onclick="answer(2)">2 - ã‚„ã‚„ä¸Šã®é¸æŠè‚¢ã«è¿‘ã„</button>
        <button class="answer-btn" onclick="answer(3)">3 - ã©ã¡ã‚‰ã¨ã‚‚ã„ãˆãªã„</button>
        <button class="answer-btn" onclick="answer(4)">4 - ã‚„ã‚„ä¸‹ã®é¸æŠè‚¢ã«è¿‘ã„</button>
        <button class="answer-btn" onclick="answer(5)">5 - ä¸‹ã®é¸æŠè‚¢ã«è¿‘ã„</button>
    </div>

    <div class="btn-group" style="margin-top: 30px;">
        <button class="btn btn-secondary" onclick="goBack()">â† æˆ»ã‚‹</button>
    </div>
</div>


<!-- ===========================
      3. çµæœç”»é¢
=========================== -->
<div class="card hidden" id="resultBox">
    <h2>ğŸ“Š è¨ºæ–­çµæœ</h2>

    <div id="loadingArea" class="loading">
        <div class="spinner"></div>
        <p>è¨ºæ–­çµæœã‚’è¨ˆç®—ä¸­ã§ã™...</p>
    </div>

    <div id="resultContent" class="hidden">
        <!-- çµæœãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="result-header" id="resultHeader">
            <p><strong id="resultName"></strong> æ§˜ã®è¨ºæ–­çµæœ</p>
            <div class="type-image" id="typeImage">ğŸŒ¸</div>
            <div class="type-badge" id="resultType"></div>
            <p class="one-liner" id="resultOneLiner"></p>
        </div>

        <!-- è©³ç´°è§£èª¬ï¼ˆ200æ–‡å­—ï¼‰ -->
        <div class="detailed-description" id="detailedDescription"></div>

        <!-- çµ„ç¹”å†…ç›¸å¯¾è©•ä¾¡ã®æ³¨é‡ˆ -->
        <div class="relative-note">
            â€» ã“ã®è¨ºæ–­çµæœã¯ã€Œã•ãã‚‰ä¼šã€ã¨ã„ã†ç‰¹å®šã®çµ„ç¹”å†…ã§ã®ç›¸å¯¾çš„ãªä½ç½®ä»˜ã‘ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ç¤¾ä¼šå…¨ä½“ã®å¹³å‡ã§ã¯ãªãã€çµ„ç¹”å†…ãƒ¡ãƒ³ãƒãƒ¼ã‚’4ã‚¿ã‚¤ãƒ—ã«åˆ†é¡ã—ãŸã‚‚ã®ã§ã™ã€‚
        </div>

        <!-- ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ -->
        <div class="section">
            <h3>ğŸ“ˆ ã‚ãªãŸã®å¿ƒã®æ§‹æˆ</h3>
            <div class="chart-container">
                <canvas id="radarChart"></canvas>
            </div>
        </div>

        <!-- 4è»¸ã®å‚¾å‘ -->
        <div class="section">
            <h3>ğŸ¯ 4ã¤ã®ç‰¹æ€§</h3>
            <div class="axis-grid" id="axisGrid"></div>
        </div>

        <!-- å¼·ã¿ -->
        <div class="section">
            <h3>ğŸ’ª å¼·ã¿</h3>
            <ul id="strengthsList"></ul>
        </div>

        <!-- å¼±ã¿ãƒ»æ³¨æ„ç‚¹ -->
        <div class="section">
            <h3>âš ï¸ æ³¨æ„ç‚¹</h3>
            <ul id="weaknessesList"></ul>
        </div>

        <!-- ã‚¹ãƒˆãƒ¬ã‚¹ -->
        <div class="section">
            <h3>ğŸ˜° ã‚¹ãƒˆãƒ¬ã‚¹ã‚’æ„Ÿã˜ã‚„ã™ã„å ´é¢</h3>
            <ul id="stressSituationsList"></ul>
        </div>

        <div class="section">
            <h3>ğŸŒ¿ ã‚¹ãƒˆãƒ¬ã‚¹å¯¾å‡¦æ³•</h3>
            <ul id="stressCopingList"></ul>
        </div>

        <!-- ä»•äº‹ã‚¹ã‚¿ã‚¤ãƒ« -->
        <div class="section">
            <h3>ğŸ’¼ ä»•äº‹ã®ã‚¹ã‚¿ã‚¤ãƒ«</h3>
            <div class="work-style-grid" id="workStyleGrid"></div>
        </div>

        <!-- ã‚¹ãƒˆãƒ¬ã‚¹è€æ€§ -->
        <div class="section">
            <h3>ğŸ›¡ï¸ ã‚¹ãƒˆãƒ¬ã‚¹è€æ€§</h3>
            <div class="stress-meter">
                <span class="stress-label" id="stressLabel">5 / 10</span>
                <div class="stress-bar">
                    <div class="stress-indicator" id="stressIndicator" style="left: 50%"></div>
                </div>
            </div>
            <p class="stress-note">â€» æ•°å€¤ãŒé«˜ã„ã»ã©ã‚¹ãƒˆãƒ¬ã‚¹è€æ€§ãŒé«˜ã„ã“ã¨ã‚’ç¤ºã—ã¾ã™</p>
        </div>


        <!-- ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
        <div id="emailStatus" class="email-status hidden"></div>

        <!-- æ“ä½œãƒœã‚¿ãƒ³ -->
        <div class="btn-group">
            <button class="btn" onclick="downloadPDF()">ğŸ“„ PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
            <button class="btn btn-secondary" onclick="downloadImage()">ğŸ–¼ï¸ ç”»åƒã§ä¿å­˜</button>
            <button class="btn btn-secondary" onclick="resetTest()">ğŸ”„ ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹</button>
        </div>
    </div>
</div>


<script>
const API_ENDPOINT = "/api/sakura_psych";

// ãƒ‘ãƒ¼ã‚½ãƒŠãƒªãƒ†ã‚£Aï¼ˆ36å•ï¼‰+ ãƒ‘ãƒ¼ã‚½ãƒŠãƒªãƒ†ã‚£Bï¼ˆ36å•ï¼‰= 72å•
const questions = [
    // ãƒ‘ãƒ¼ã‚½ãƒŠãƒªãƒ†ã‚£A (A01-A36)
    "æ¥½è¦³çš„ã \nor\nå¿ƒé…æ€§ã ",
    "ç«¶äº‰ã®ã‚ã‚‹ç’°å¢ƒã§åƒããŸã„\nor\nç«¶äº‰ã®ãªã„ç’°å¢ƒã§åƒããŸã„",
    "ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã¨ä»•äº‹ã¨ã®é–“ã«åŒºåˆ¥ãŒãªãã¦ã‚‚ã„ã„\nor\nãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã¨ä»•äº‹ã¯ã¯ã£ãã‚Šåˆ†ã‘ãŸã„",
    "èˆˆå‘³ã®ãªã„ä»•äº‹ã§ã‚‚çµ¦æ–™ãŒé«˜ã‘ã‚Œã°ã„ã„\nor\nçµ¦æ–™ãŒä½ãã¦ã‚‚è‡ªåˆ†ã®ã‚„ã‚ŠãŸã„ä»•äº‹ã‚’ã—ãŸã„",
    "ãƒªã‚¹ã‚¯ã¯ã‚ã‚‹ãŒãƒªã‚¿ãƒ¼ãƒ³ã®å¯èƒ½æ€§ã®ã‚ã‚‹ã‚­ãƒ£ãƒªã‚¢ã‚’æ­©ã¿ãŸã„\nor\nç€å®Ÿã§å®‰å®šã—ãŸã‚­ãƒ£ãƒªã‚¢ã‚’æ­©ã¿ãŸã„",
    "è‡ªåˆ†ãŒç´å¾—ã—ã‚„ã™ã„ã®ã¯è«–ç†çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã \nor\næ„Ÿæƒ…ã®ã“ã‚‚ã£ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã ",
    "ä»•äº‹é‡è¦–ã ã¨æ€ã†\nor\nãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆé‡è¦–ã ã¨æ€ã†",
    "äººã‹ã‚‰è©•ä¾¡ã•ã‚Œã‚‹ã“ã¨ãŒå¤§äº‹\nor\nè‡ªåˆ†ãŒæ­£ã—ã„ã¨æ€ã†ã“ã¨ãŒå¤§äº‹",
    "ç©æ¥µçš„ã«äººã¨é–¢ã‚ã‚‹æ–¹ã \nor\näººã¨é–¢ã‚ã‚‹ã®ã¯ã‚ã¾ã‚Šå¥½ããªæ–¹ã§ã¯ãªã„",
    "ãƒªã‚¹ã‚¯ã¯ã¨ã‚ŠãŸããªã„\nor\nãƒªã‚¹ã‚¯ã‚’ã¨ã‚‹ã“ã¨ã¯ã„ã¨ã‚ãªã„",
    "å‘¨ã‚ŠãŒæ¥½ã—ããªã‘ã‚Œã°è‡ªåˆ†ã‚‚æ¥½ã—ããªã„\nor\nè‡ªåˆ†ãŒæ¥½ã—ã‘ã‚Œã°æ¥½ã—ã„ã¨æ„Ÿã˜ã‚‰ã‚Œã‚‹",
    "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦åƒããŸã„\nor\nãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¨ã—ã¦åƒããŸã„",
    "è·å ´ã®äººã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚’å…±æœ‰ã—ãŸã„\nor\nè·å ´ã®äººã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚’å…±æœ‰ã—ãŸã„ã¨ã¯æ€ã‚ãªã„",
    "ç§ã®åˆ¤æ–­ã¯æ„Ÿæƒ…ã«å·¦å³ã•ã‚Œã‚‹ã“ã¨ãŒå¤šã„\nor\næ„Ÿæƒ…ã«å·¦å³ã•ã‚Œã‚‹ã“ã¨ã¯å°‘ãªã„",
    "äººã¨æ¯”ã¹ã¦å–œæ€’å“€æ¥½ãŒãªã„æ–¹ã ã¨æ€ã†\nor\nå–œæ€’å“€æ¥½ãŒã‚ã‚‹æ–¹ã ã¨æ€ã†",
    "å¤±æ•—ã™ã‚‹ã¨å¼•ããšã‚‹\nor\nåˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹",
    "ã™ãä»–äººã«åŒæƒ…ã—ã¦ã—ã¾ã†\nor\nä»–äººã«åŒæƒ…ã—ãªã„æ–¹ã ",
    "ãƒãƒ¼ãƒ ã®æˆé•·ã®ãŸã‚ã«åƒããŸã„\nor\nè‡ªèº«ã®å°‚é–€æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã«åƒããŸã„",
    "æ°—æŒã¡ãŒé«˜ã¶ã£ã¦è½ã¡ç€ã‹ãªã„ã“ã¨ãŒã‚ã‚‹\nor\nã»ã¨ã‚“ã©ãªã„",
    "ã©ã¡ã‚‰ã‹ã¨ã„ã†ã¨ç†å±ˆã£ã½ã„äººãŒè‹¦æ‰‹ã \nor\nã™ãæ„Ÿæƒ…çš„ã«ãªã‚‹äººãŒè‹¦æ‰‹ã ",
    "æ™®æ®µã‚¹ãƒˆãƒ¬ã‚¹ã‚’æ„Ÿã˜ã«ãã„æ–¹ã \nor\næ„Ÿã˜ã‚„ã™ã„æ–¹ã ",
    "å”èª¿ã™ã‚‹ã®ãŒå¥½ã\nor\nç«¶äº‰ã™ã‚‹ã®ãŒå¥½ã",
    "çµ¦æ–™ãŒé«˜ã„æ–¹ãŒã„ã„\nor\nã‚„ã‚ŠãŸã„ä»•äº‹ãŒã§ãã‚‹æ–¹ãŒã„ã„",
    "ä¸€äººã§é›†ä¸­ã—ã¦ã™ã‚‹ä»•äº‹ã®æ–¹ãŒå¥½ãã \nor\näººã¨ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å–ã‚ŠãªãŒã‚‰ã™ã‚‹ä»•äº‹ã®æ–¹ãŒå¥½ãã ",
    "ç¤¾äº¤çš„ã§ã¯ãªã„ã¨æ€ã†\nor\nç¤¾äº¤çš„ã ã¨æ€ã†",
    "èˆˆå¥®ã—ã‚„ã™ã„\nor\nå¸¸ã«å†·é™",
    "æ˜ ç”»ãªã©ã§å…±æ„Ÿã—ã¦ã‚ˆãæ³£ã„ã¦ã—ã¾ã†\nor\nã‚ã¾ã‚Šæ³£ãã“ã¨ã¯ãªã„",
    "ä»•äº‹ã®è©•ä¾¡ã‚’çµæœã®ã¿ã§åˆ¤æ–­ã•ã‚ŒãŸã„\nor\nã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãªã©ãƒ—ãƒ­ã‚»ã‚¹ã‚‚å«ã‚ã¦åˆ¤æ–­ã•ã‚ŒãŸã„",
    "ä»–äººã«ã©ã†æ€ã‚ã‚Œã¦ã„ã‚‹ã‹æ°—ã«ãªã‚‰ãªã„\nor\nä»–äººã«ã©ã†æ€ã‚ã‚Œã¦ã„ã‚‹ã‹æ°—ã«ãªã‚‹",
    "åˆå¯¾é¢ã®äººã¨ã‚‚ã™ãè¦ªã—ããªã‚Œã‚‹\nor\näººè¦‹çŸ¥ã‚Šã™ã‚‹æ–¹ã ã¨æ€ã†",
    "ä»–äººã«å…±æ„Ÿã—ã‚„ã™ã„\nor\nã‚ã¾ã‚Šå…±æ„Ÿã—ãªã„æ–¹ã ",
    "ã§ãã‚‹ãªã‚‰è²¬ä»»ã‚’è² ã†ã‚ˆã†ãªä»•äº‹ã¯ã—ãŸããªã„\nor\nè²¬ä»»ã‚’è² ã†ã‚ˆã†ãªä»•äº‹ã®æ–¹ãŒã„ã„",
    "ä¸–ç•Œå…¨ä½“ã®å¹¸ç¦ã‚’å„ªå…ˆã—ãŸã„\nor\nè‡ªèº«ã®å¯Œã‚„åœ°ä½ã‚’å„ªå…ˆã—ãŸã„",
    "ä»•äº‹ã‚ˆã‚Šã‚‚ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚’å„ªå…ˆã—ã¦ããŸ\nor\nãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚ˆã‚Šã‚‚ä»•äº‹ã‚’å„ªå…ˆã—ã¦ããŸ",
    "ç«¶ã„åˆã£ã¦æˆé•·ã—ãŸã„\nor\nåŠ©ã‘åˆã£ã¦æˆé•·ã—ãŸã„",
    "æ–°ã—ã„ä»•äº‹ã‚’ä½œã‚Šä¸Šã’ãŸã„\nor\næ—¢å­˜äº‹æ¥­ã‚’æˆé•·ã•ã›ãŸã„",
    // ãƒ‘ãƒ¼ã‚½ãƒŠãƒªãƒ†ã‚£B (B01-B36)
    "ã‚¹ãƒãƒ¼ãƒ„ã¯è¦‹ã‚‹ã‚ˆã‚Šã‚‚ã‚„ã‚‹æ–¹ãŒã„ã„\nor\nã‚¹ãƒãƒ¼ãƒ„ã¯ã‚„ã‚‹ã‚ˆã‚Šã‚‚è¦‹ã‚‹æ–¹ãŒã„ã„",
    "é£½ãã£ã½ããªã„\nor\nã™ãã«é£½ãã‚‹æ–¹ã ",
    "ä½•ã§ã‚‚è‡ªåˆ†ãŒæ‚ªã„ã¨æ€ã„ãŒã¡ã \nor\nä½•ã§ã‚‚è‡ªåˆ†ãŒæ‚ªã„ã¨ã¯æ€ã‚ãªã„",
    "ç‹¬è‡ªã®ä¿¡å¿µãŒã‚ã‚‹\nor\nç‹¬è‡ªã®ä¿¡å¿µãŒã‚ã‚‹ã¨ã¾ã§ã¯è¨€ãˆãªã„",
    "äººã®è©±ã«ã™ãã«ç´å¾—ã™ã‚‹\nor\nã‚ã¾ã‚Šç´å¾—ã—ãªã„",
    "ã‚ã£ãŸã«è½ã¡è¾¼ã‚€ã“ã¨ã¯ãªã„\nor\nã™ãã«è½ã¡è¾¼ã‚€æ–¹ã ",
    "æœæ•¢ã«æŒ‘æˆ¦ã™ã‚‹ã‚¿ã‚¤ãƒ—ã \nor\næœæ•¢ã«æŒ‘æˆ¦ã™ã‚‹ã‚ˆã†ãªã‚¿ã‚¤ãƒ—ã§ã¯ãªã„",
    "æ…é‡ã•ã‚’æ¬ ã„ã¦å¾Œæ‚”ã—ãŸã“ã¨ãŒã‚ã‚‹\nor\næ…é‡ã«ãªã‚Šã™ãã¦ãƒãƒ£ãƒ³ã‚¹ã‚’é€ƒã—ãŸã“ã¨ãŒã‚ã‚‹",
    "ã¡ã‚‡ã£ã¨ã—ãŸç‰©éŸ³ã§ã‚‚æ°—ã«ãªã‚‹\nor\nã»ã¨ã‚“ã©æ°—ã«ãªã‚‰ãªã„",
    "è‡ªåˆ†ã«è‚¯å®šçš„ãªæ–¹ã ã¨æ€ã†\nor\nè‡ªåˆ†ã«å¦å®šçš„ãªæ–¹ã ã¨æ€ã†",
    "è‡ªåˆ†ã¯æ°—åˆ†å±‹ã ã¨æ€ã†\nor\næ°—åˆ†å±‹ã§ã¯ãªã„",
    "ã‚³ãƒ„ã‚³ãƒ„åŠªåŠ›ã™ã‚‹ã‚¿ã‚¤ãƒ—ã \nor\nã‚³ãƒ„ã‚³ãƒ„åŠªåŠ›ã™ã‚‹ã‚¿ã‚¤ãƒ—ã§ã¯ãªã„",
    "å¤±æ•—ãŒã„ã¤ã¾ã§ã‚‚æ°—ã«ãªã‚‹\nor\nã™ãã«æ°—ã«ãªã‚‰ãªããªã‚‹",
    "æ¬²ã®ãªã„æ–¹ã ã¨æ€ã†\nor\né‡å¿ƒå®¶ã ã¨æ€ã†",
    "è‡ªåˆ†ã‚ˆã‚Šäººã¨ã®é–¢ä¿‚ã‚’å„ªå…ˆã™ã‚‹æ–¹ã \nor\näººã¨ã®é–¢ä¿‚ã‚ˆã‚Šè‡ªåˆ†ã‚’å„ªå…ˆã™ã‚‹æ–¹ã ",
    "ãƒ’ã‚½ãƒ’ã‚½è©±ã¯è‡ªåˆ†ã®ã“ã¨ã ã¨æ€ã£ã¦ã—ã¾ã†\nor\nå…¨ãæ€ã‚ãªã„",
    "ä½•äº‹ã‚‚ã‚„ã‚‹æ°—ãŒãªã„ã¨æ€ã†\nor\nä½•äº‹ã‚‚ã‚„ã‚‹æ°—ãŒã‚ã‚‹ã¨æ€ã†",
    "äººã®è¨€ã†ã“ã¨ã¯ã‚ˆãèã\nor\näººã®è¨€ã†ã“ã¨ã‚’ã‚ã¾ã‚Šèã‹ãªã„æ–¹ã ",
    "ã©ã¡ã‚‰ã‹ã¨ã„ã†ã¨è»½ç‡ãªæ–¹ã \nor\næ…é‡æ´¾ã ",
    "é–“é•ã£ã¦ã„ã‚‹ã“ã¨ã«ã¯é»™ã£ã¦ã„ã‚‰ã‚Œãªã„\nor\né–“é•ã£ã¦ã„ã¦ã‚‚é»™ã£ã¦ã„ã‚‰ã‚Œã‚‹",
    "è¡Œå‹•ã—ã¦ã‹ã‚‰è€ƒãˆã‚‹æ–¹ã \nor\nè€ƒãˆã¦ã‹ã‚‰è¡Œå‹•ã™ã‚‹æ–¹ã ",
    "é£½ãã£ã½ã„æ–¹ã \nor\næ ¹æ°—ãŒã‚ã‚‹æ–¹ã ",
    "ã‚³ãƒ­ã‚³ãƒ­ã¨æ„è¦‹ãŒå¤‰ã‚ã‚‹æ–¹ã \nor\nã‚³ãƒ­ã‚³ãƒ­ã¨æ„è¦‹ã‚’å¤‰ãˆã‚‹ã“ã¨ã¯ãªã„",
    "å€‹æ€§çš„ãªäººé–“ã ã¨è¨€ã‚ã‚Œã‚‹\nor\nå€‹æ€§çš„ã¨ã¾ã§ã¯è¨€ã‚ã‚Œãªã„",
    "äººã¨ã™ãã«ã†ã¡ã¨ã‘ã‚‹\nor\nã™ãã«ã¯ã†ã¡ã¨ã‘ãªã„",
    "èº«ä½“ã‚’å‹•ã‹ã™ã®ã¯å¥½ããªæ–¹ã \nor\nèº«ä½“ã‚’å‹•ã‹ã™ã®ã¯å¥½ããªæ–¹ã§ã¯ãªã„",
    "èã‹ã‚ŒãŸã“ã¨ã¯å³åº§ã«ç­”ãˆã‚‹æ–¹ã \nor\nååˆ†è€ƒãˆã¦ã‹ã‚‰ç­”ãˆã‚‹æ–¹ã ",
    "äººç”Ÿã®ç›®æ¨™ã¯æ‰‹ã®å±Šãç¯„å›²ãŒã„ã„\nor\näººç”Ÿã®ç›®æ¨™ã¯å¤§ãã„æ–¹ãŒã„ã„",
    "ã¨ã«ã‹ãè¡Œå‹•ã™ã‚‹\nor\nç„¡ç†ã«è¡Œå‹•ã—ãªã„",
    "ç¥çµŒè³ªãªæ–¹ã \nor\nç¥çµŒè³ªãªæ–¹ã§ã¯ãªã„",
    "äººã®æ¬ ç‚¹ã‚’æŒ‡æ‘˜ã—ãŒã¡ã \nor\næ»…å¤šã«æŒ‡æ‘˜ã—ãªã„",
    "è‡ªåˆ†ã®ä¸–ç•Œã‚’æŒã£ã¦ã„ãªã„ã¨æ€ã†\nor\nè‡ªåˆ†ã®ä¸–ç•Œã‚’æŒã£ã¦ã„ã‚‹",
    "è‡ªåˆ†ã¯å¼·æƒ…ã ã¨æ€ã†\nor\nè‡ªåˆ†ã¯ç´ ç›´ã ã¨æ€ã†",
    "è‡ªåˆ†ã¯ç²˜ã‚Šå¼·ã„äººé–“ã \nor\nã‚ã¾ã‚Šç²˜ã‚Šå¼·ããªã„æ–¹ã ",
    "è‡ªåˆ†ã«è‡ªä¿¡ãŒã‚ã‚‹\nor\nè‡ªåˆ†ã«è‡ªä¿¡ãŒãªã„æ–¹ã ",
    "ã‚ˆã„ã¨æ€ã£ã¦ã‚‚ã•ã‚‰ã«æ¤œè¨ã—ã¦ã‹ã‚‰å®Ÿè¡Œã™ã‚‹\nor\nã‚ˆã„ã¨æ€ãˆã°ã™ãã«å®Ÿè¡Œã«ç§»ã‚‹",
];

let currentIndex = 0;
let answers = [];
let userData = {};
let currentResultId = null;

// ä¼šç¤¾ã‚«ãƒ†ã‚´ãƒªã‚’èª­ã¿è¾¼ã¿
async function loadCompanyCategories() {
    try {
        const response = await fetch("/api/company_categories");
        const data = await response.json();
        if (data.ok) {
            const select = document.getElementById("userCompany");
            data.categories.forEach(cat => {
                const option = document.createElement("option");
                option.value = cat;
                option.textContent = cat;
                select.appendChild(option);
            });
        }
    } catch (e) {
        console.error("Failed to load company categories:", e);
    }
}

// åˆæœŸåŒ–
document.addEventListener("DOMContentLoaded", () => {
    loadCompanyCategories();
});

function startTest() {
    const name = document.getElementById("userName").value.trim();
    const company = document.getElementById("userCompany").value;

    if (!name) {
        alert("ãŠåå‰ã¯å¿…é ˆã§ã™ã€‚");
        return;
    }

    userData = {
        name,
        company,
        status: "active"
    };
    currentIndex = 0;
    answers = [];

    document.getElementById("startBox").classList.add("hidden");
    document.getElementById("questionBox").classList.remove("hidden");
    document.getElementById("resultBox").classList.add("hidden");

    showQuestion();
}

function showQuestion() {
    const progress = ((currentIndex) / questions.length) * 100;
    document.getElementById("progressFill").style.width = progress + "%";
    document.getElementById("progressText").innerText =
        `è³ªå• ${currentIndex + 1} / ${questions.length}`;
    document.getElementById("questionText").innerHTML = questions[currentIndex].replace(/\n/g, '<br>');
}

function answer(value) {
    answers.push(Number(value));
    currentIndex++;

    if (currentIndex >= questions.length) {
        finishTest();
    } else {
        showQuestion();
    }
}

function goBack() {
    if (currentIndex > 0) {
        currentIndex--;
        answers.pop();
        showQuestion();
    } else {
        if (confirm("å…¥åŠ›ç”»é¢ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿå›ç­”ã¯ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚")) {
            document.getElementById("questionBox").classList.add("hidden");
            document.getElementById("startBox").classList.remove("hidden");
        }
    }
}

function finishTest() {
    document.getElementById("questionBox").classList.add("hidden");
    document.getElementById("resultBox").classList.remove("hidden");
    document.getElementById("loadingArea").classList.remove("hidden");
    document.getElementById("resultContent").classList.add("hidden");

    sendResultsToServer();
}

async function sendResultsToServer() {
    try {
        const response = await fetch(API_ENDPOINT, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                answers: answers,
                meta: userData
            }),
        });

        const data = await response.json();
        console.log("API response:", data);

        if (!data.ok) {
            showError("è¨ºæ–­å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼š" + (data.error || "ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"));
            return;
        }

        currentResultId = data.result_id;
        displayResult(data);

    } catch (err) {
        console.error(err);
        showError("ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
    }
}

function showError(message) {
    document.getElementById("loadingArea").classList.add("hidden");
    document.getElementById("resultContent").classList.remove("hidden");
    document.getElementById("resultContent").innerHTML = `
        <div style="text-align: center; color: #cc0000; padding: 40px;">
            <p>âš ï¸ ${message}</p>
            <button class="btn btn-secondary" onclick="resetTest()">ğŸ”„ ã‚‚ã†ä¸€åº¦è©¦ã™</button>
        </div>
    `;
}

function displayResult(data) {
    const report = data.report;
    const result = data.result;

    document.getElementById("loadingArea").classList.add("hidden");
    document.getElementById("resultContent").classList.remove("hidden");

    // åŸºæœ¬æƒ…å ±
    document.getElementById("resultName").textContent = userData.name;
    document.getElementById("resultType").textContent =
        `${getTypeNameJP(result.type)}ï¼ˆTYPE ${result.type}ï¼‰`;
    document.getElementById("resultOneLiner").textContent = report.one_liner;

    // ã‚¿ã‚¤ãƒ—åˆ¥ç”»åƒï¼ˆSVGç”»åƒã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯çµµæ–‡å­—ï¼‰
    const typeImageEl = document.getElementById("typeImage");
    const typeImages = {
        "S": "/static/images/type_s.svg",
        "P": "/static/images/type_p.svg",
        "C": "/static/images/type_c.svg",
        "D": "/static/images/type_d.svg"
    };
    const typeEmojis = { "S": "ğŸ¤", "P": "â˜€ï¸", "C": "ğŸ“Š", "D": "ğŸ¯" };
    if (typeImages[result.type]) {
        typeImageEl.innerHTML = `<img src="${typeImages[result.type]}" alt="TYPE ${result.type}" style="width:100%;height:100%;object-fit:contain;">`;
    } else {
        typeImageEl.textContent = typeEmojis[result.type] || "ğŸŒ¸";
    }

    // è©³ç´°è§£èª¬
    if (report.detailed_description) {
        document.getElementById("detailedDescription").textContent = report.detailed_description;
    }

    // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
    renderRadarChart(report.axis_info);

    // 4è»¸
    const axisGrid = document.getElementById("axisGrid");
    axisGrid.innerHTML = "";
    report.axis_info.forEach(axis => {
        axisGrid.innerHTML += `
            <div class="axis-item">
                <span class="axis-name">${axis.name}</span>
                <span class="axis-level">${axis.level}</span>
                <p class="axis-desc">${axis.description}</p>
            </div>
        `;
    });

    // å¼·ã¿
    const strengthsList = document.getElementById("strengthsList");
    strengthsList.innerHTML = "";
    report.strengths.forEach(s => {
        strengthsList.innerHTML += `<li>${s}</li>`;
    });

    // å¼±ã¿
    const weaknessesList = document.getElementById("weaknessesList");
    weaknessesList.innerHTML = "";
    report.weaknesses.forEach(w => {
        weaknessesList.innerHTML += `<li>${w}</li>`;
    });

    // ã‚¹ãƒˆãƒ¬ã‚¹å ´é¢
    const stressSituationsList = document.getElementById("stressSituationsList");
    stressSituationsList.innerHTML = "";
    report.stress_situations.forEach(s => {
        stressSituationsList.innerHTML += `<li>${s}</li>`;
    });

    // ã‚¹ãƒˆãƒ¬ã‚¹å¯¾å‡¦æ³•
    const stressCopingList = document.getElementById("stressCopingList");
    stressCopingList.innerHTML = "";
    report.stress_coping.forEach(c => {
        stressCopingList.innerHTML += `<li>${c}</li>`;
    });

    // ä»•äº‹ã‚¹ã‚¿ã‚¤ãƒ«
    const workStyleGrid = document.getElementById("workStyleGrid");
    const ws = report.work_style;
    workStyleGrid.innerHTML = `
        <div class="work-style-item">
            <div class="work-style-label">å”åƒã‚¹ã‚¿ã‚¤ãƒ«</div>
            <div class="work-style-value">${ws.collaboration}</div>
        </div>
        <div class="work-style-item">
            <div class="work-style-label">ãƒšãƒ¼ã‚¹</div>
            <div class="work-style-value">${ws.pace}</div>
        </div>
        <div class="work-style-item">
            <div class="work-style-label">ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</div>
            <div class="work-style-value">${ws.approach}</div>
        </div>
        <div class="work-style-item">
            <div class="work-style-label">æ€è€ƒã‚¹ã‚¿ã‚¤ãƒ«</div>
            <div class="work-style-value">${ws.thinking}</div>
        </div>
    `;

    // ã‚¹ãƒˆãƒ¬ã‚¹è€æ€§
    const stressTolerance = report.stress_tolerance;
    document.getElementById("stressLabel").textContent = `${stressTolerance} / 10`;
    const stressPct = ((stressTolerance - 1) / 9) * 100;
    document.getElementById("stressIndicator").style.left = stressPct + "%";

}

function renderRadarChart(axisInfo) {
    const ctx = document.getElementById("radarChart").getContext("2d");

    // æ—¢å­˜ãƒãƒ£ãƒ¼ãƒˆã‚’ç ´æ£„
    if (window.radarChartInstance) {
        window.radarChartInstance.destroy();
    }

    const labels = axisInfo.map(a => a.name);
    const data = axisInfo.map(a => (a.level_index + 1) * 20);

    window.radarChartInstance = new Chart(ctx, {
        type: "radar",
        data: {
            labels: labels,
            datasets: [{
                label: "ã‚ãªãŸã®å‚¾å‘",
                data: data,
                fill: true,
                backgroundColor: "rgba(199, 21, 133, 0.2)",
                borderColor: "rgba(199, 21, 133, 1)",
                pointBackgroundColor: "rgba(199, 21, 133, 1)",
                pointBorderColor: "#fff",
                pointHoverBackgroundColor: "#fff",
                pointHoverBorderColor: "rgba(199, 21, 133, 1)"
            }]
        },
        options: {
            elements: {
                line: { borderWidth: 3 }
            },
            scales: {
                r: {
                    angleLines: { display: true },
                    suggestedMin: 0,
                    suggestedMax: 100,
                    ticks: { stepSize: 20, display: false }
                }
            },
            plugins: {
                legend: { display: false }
            }
        }
    });
}

function getTypeNameJP(type) {
    const map = {
        "S": "å’Œå‹",
        "P": "é™½å‹",
        "C": "ç†å‹",
        "D": "å°å‹"
    };
    return map[type] || type;
}

async function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const element = document.getElementById("resultContent");

    try {
        const canvas = await html2canvas(element, {
            scale: 2,
            useCORS: true,
            logging: false
        });

        const imgData = canvas.toDataURL("image/png");
        const pdf = new jsPDF("p", "mm", "a4");
        const imgWidth = 190;
        const pageHeight = 277;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        let heightLeft = imgHeight;
        let position = 10;

        pdf.addImage(imgData, "PNG", 10, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;

        while (heightLeft >= 0) {
            position = heightLeft - imgHeight + 10;
            pdf.addPage();
            pdf.addImage(imgData, "PNG", 10, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
        }

        pdf.save(`ã•ãã‚‰ä¼šè¨ºæ–­çµæœ_${userData.name}.pdf`);
    } catch (err) {
        console.error("PDF generation failed:", err);
        alert("PDFã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
    }
}

async function downloadImage() {
    const element = document.getElementById("resultContent");

    try {
        const canvas = await html2canvas(element, {
            scale: 2,
            useCORS: true,
            logging: false
        });

        const link = document.createElement("a");
        link.download = `ã•ãã‚‰ä¼šè¨ºæ–­çµæœ_${userData.name}.png`;
        link.href = canvas.toDataURL("image/png");
        link.click();
    } catch (err) {
        console.error("Image generation failed:", err);
        alert("ç”»åƒã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
    }
}


function resetTest() {
    currentIndex = 0;
    answers = [];
    userData = {};
    currentResultId = null;

    document.getElementById("resultBox").classList.add("hidden");
    document.getElementById("startBox").classList.remove("hidden");

    // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
    document.getElementById("userName").value = "";
    document.getElementById("userCompany").value = "";
}
</script>

</body>
</html>
